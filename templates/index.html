<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FitTrack | Smart Fitness Tracker</title>

  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-buttons.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/branding.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/nav-adaptive.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/site-footer.css') }}" />
</head>
<body class="ft-home">
  <a class="skip-link" href="#main-content">Skip to main content</a>

  <nav class="navbar navbar-expand-lg navbar-dark fixed-top nav-glass ft-nav is-glass" aria-label="Primary">
    <div class="container nav-shell">
      <a class="navbar-brand brand-pill ft-brand" href="{{ url_for('index') }}">
        <img class="ft-logo" src="{{ url_for('static', filename='images/FitTrack.jpg') }}" alt="FitTrack Logo">
        <span class="ft-word">FitTrack</span>
      </a>

      <ul class="navbar-nav nav-links d-none d-lg-flex">
        <li class="nav-item">
          <a class="nav-link home-btn-global home-nav-btn active" href="#home">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
          </a>
        </li>
        <li class="nav-item"><a class="nav-link" href="#benefits">Benefits</a></li>
        <li class="nav-item"><a class="nav-link" href="#how">How It Works</a></li>
        <li class="nav-item"><a class="nav-link" href="#stories">Stories</a></li>
        <li class="nav-item"><a class="nav-link" href="#faq">FAQ</a></li>
      </ul>

      <div class="nav-actions d-none d-lg-flex">
        <a class="btn admin-btn-global" href="{{ url_for('admin_login') }}" id="adminBtn">
          <i class="fa-solid fa-crown"></i> Admin
        </a>
        <a class="btn user-btn-global" href="{{ url_for('user_dashboard') }}" id="users-btn">
          <i class="fa-solid fa-user"></i> Users
        </a>
      </div>

      <button class="btn mobile-menu-btn d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#homeSidebar" aria-controls="homeSidebar" aria-label="Open menu">
        <i class="fa-solid fa-bars"></i>
      </button>
    </div>
  </nav>

  <div class="offcanvas offcanvas-end home-sidebar d-lg-none" tabindex="-1" id="homeSidebar" aria-labelledby="homeSidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title brand-pill ft-brand" id="homeSidebarLabel">
        <img class="ft-logo" src="{{ url_for('static', filename='images/FitTrack.jpg') }}" alt="FitTrack Logo">
        <span class="ft-word">FitTrack</span>
        <span class="ft-word-tag">Menu</span>
      </h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <nav class="sidebar-nav" aria-label="Mobile section navigation">
        <a class="nav-link active" href="#home" data-bs-dismiss="offcanvas">Home</a>
        <a class="nav-link" href="#benefits" data-bs-dismiss="offcanvas">Benefits</a>
        <a class="nav-link" href="#how" data-bs-dismiss="offcanvas">How It Works</a>
        <a class="nav-link" href="#stories" data-bs-dismiss="offcanvas">Stories</a>
        <a class="nav-link" href="#faq" data-bs-dismiss="offcanvas">FAQ</a>
      </nav>
      <div class="sidebar-actions mt-auto pt-3">
        <a class="btn admin-btn-global mb-2 w-100" href="{{ url_for('admin_login') }}" data-bs-dismiss="offcanvas">
          <i class="fa-solid fa-crown"></i> Admin
        </a>
        <a class="btn user-btn-global w-100" href="{{ url_for('user_dashboard') }}" data-bs-dismiss="offcanvas">
          <i class="fa-solid fa-user"></i> Users
        </a>
      </div>
    </div>
  </div>

  <main id="main-content">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <section class="container mt-3" aria-label="System messages">
          {% for category, message in messages %}
            {% set c = category %}
            {% if c not in ['primary','secondary','success','danger','warning','info','light','dark'] %}
              {% set c = 'info' %}
            {% endif %}
            <div class="alert alert-{{ c }} mb-2" role="alert">{{ message }}</div>
          {% endfor %}
        </section>
      {% endif %}
    {% endwith %}

    <header id="home" class="hero">
      <div class="container hero-grid">
        <div class="hero-copy" data-aos="fade-up">
          <p class="eyebrow">Performance tracking for real routines</p>
          <h1 class="hero-title">A cleaner way to train, measure, and improve.</h1>
          <p class="hero-sub">
            Replace scattered notes with one focused dashboard: log workouts quickly, monitor weekly trends, and make better decisions with reliable data.
          </p>
          <div class="hero-actions">
            <a href="{{ url_for('register') }}" class="btn btn-primary btn-lg btn-cta">Create Your Account</a>
            <a href="#how" class="btn btn-outline-light btn-lg btn-ghost">How It Works</a>
          </div>
          
          <div class="hero-meta">
            <span><i class="fa-solid fa-lock"></i> Passwords hashed</span>
            <span><i class="fa-solid fa-database"></i> MySQL-backed</span>
            <span><i class="fa-solid fa-mobile-screen"></i> Responsive on all devices</span>
          </div>
        </div>

        <div class="hero-card" data-aos="fade-left">
          <article class="snapshot-card">
            <div class="snapshot-head">
              <h2>Today’s Snapshot</h2>
              <span class="live-pill"><span class="pulse"></span>Live</span>
            </div>
            <div class="snapshot-metrics">
              <div>
                <p>Calories burned</p>
                <strong><span id="snapCalories">520</span> kcal</strong>
              </div>
              <div>
                <p>Total workouts</p>
                <strong><span id="snapTotal">4</span></strong>
              </div>
              <div>
                <p>Weekly goal</p>
                <strong><span id="snapGoal">72</span>%</strong>
              </div>
            </div>
            <div class="snapshot-bars" aria-label="Weekly calories visual">
              <span class="bar" id="snapBar0" title="Mon: 0 kcal"></span>
              <span class="bar" id="snapBar1" title="Tue: 0 kcal"></span>
              <span class="bar" id="snapBar2" title="Wed: 0 kcal"></span>
              <span class="bar" id="snapBar3" title="Thu: 0 kcal"></span>
              <span class="bar" id="snapBar4" title="Fri: 0 kcal"></span>
              <span class="bar" id="snapBar5" title="Sat: 0 kcal"></span>
              <span class="bar" id="snapBar6" title="Sun: 0 kcal"></span>
            </div>
          </article>
        </div>
      </div>
    </header>

    <section class="trust-strip" aria-label="Core strengths">
      <div class="container trust-grid">
        <div><i class="fa-solid fa-shield-halved"></i> Secure role-based access</div>
        <div><i class="fa-solid fa-chart-line"></i> Weekly analytics that are easy to read</div>
        <div><i class="fa-solid fa-file-csv"></i> One-click Documents export</div>
        <div><i class="fa-solid fa-gauge-high"></i> Lightweight, fast workflow</div>
      </div>
    </section>

    <section id="benefits" class="section">
      <div class="container">
        <div class="section-head text-center" data-aos="fade-up">
          <span class="section-kicker">Benefits</span>
          <h2>Built for consistency</h2>
          <p>See exactly what you did, what changed this week, and where to improve next.</p>
        </div>

        <div class="benefit-grid">
          <article class="benefit-card" data-aos="fade-up">
            <div class="icon-circle"><i class="fa-solid fa-dumbbell"></i></div>
            <h3>Fast workout logging</h3>
            <p>Add activity, duration, and calories quickly without extra complexity.</p>
          </article>
          <article class="benefit-card" data-aos="fade-up" data-aos-delay="80">
            <div class="icon-circle"><i class="fa-solid fa-chart-pie"></i></div>
            <h3>Clear weekly trends</h3>
            <p>Understand performance patterns instead of relying on memory.</p>
          </article>
          <article class="benefit-card" data-aos="fade-up" data-aos-delay="160">
            <div class="icon-circle"><i class="fa-solid fa-user-shield"></i></div>
            <h3>Secure by default</h3>
            <p>Role separation, hashed passwords, and session-based protection.</p>
          </article>
          <article class="benefit-card" data-aos="fade-up" data-aos-delay="240">
            <div class="icon-circle"><i class="fa-solid fa-cloud-arrow-down"></i></div>
            <h3>Export when needed</h3>
            <p>Download data for reporting, backup, or further analysis.</p>
          </article>
        </div>
      </div>
    </section>

    <section id="how" class="section section-alt">
      <div class="container">
        <div class="section-head text-center" data-aos="fade-up">
          <span class="section-kicker">How It Works</span>
          <h2>How FitTrack works</h2>
          <p>Three clear steps from first login to measurable progress.</p>
        </div>
        <div class="how-grid">
          <article class="how-card" data-aos="fade-up">
            <span class="step-badge">01</span>
            <h3>Create account</h3>
            <p>Register once and start with a clean dashboard.</p>
          </article>
          <article class="how-card" data-aos="fade-up" data-aos-delay="100">
            <span class="step-badge">02</span>
            <h3>Log workouts daily</h3>
            <p>Track each session with duration and calories.</p>
          </article>
          <article class="how-card" data-aos="fade-up" data-aos-delay="200">
            <span class="step-badge">03</span>
            <h3>Review, adjust, improve</h3>
            <p>Use weekly charts and stats to refine your habits.</p>
          </article>
        </div>
      </div>
    </section>

    <section id="stories" class="section">
      <div class="container">
        <div class="section-head text-center" data-aos="fade-up">
          <span class="section-kicker">Stories</span>
          <h2>Results from consistent habits</h2>
          <p>Users improve because the data stays visible and actionable.</p>
        </div>
        
        <div class="story-grid">
          <article class="story-card" data-aos="fade-up">
            <img src="{{ url_for('static', filename='images/james.jpg') }}" alt="James, 38 — FitTrack user testimonial">
            <div>
              <div class="story-rating" aria-label="5 out of 5 stars">
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
              </div>
              <p class="story-quote">“FitTrack helped me connect habits to outcomes and stay accountable.”</p>
              <strong class="story-name">James, 38</strong>
              <span class="story-outcome">Improved blood sugar levels</span>
            </div>
          </article>
          <article class="story-card" data-aos="fade-up" data-aos-delay="100">
            <img src="{{ url_for('static', filename='images/Darren.jpg') }}" alt="Darren, 45 — FitTrack user testimonial">
            <div>
              <div class="story-rating" aria-label="5 out of 5 stars">
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
              </div>
              <p class="story-quote">“The dashboard makes progress obvious — it keeps me consistent.”</p>
              <strong class="story-name">Darren, 45</strong>
              <span class="story-outcome">More energy and focus</span>
            </div>
          </article>
          <article class="story-card" data-aos="fade-up" data-aos-delay="200">
            <img src="{{ url_for('static', filename='images/Jamie.jpg') }}" alt="Melanie, 54 — FitTrack user testimonial">
            <div>
              <div class="story-rating" aria-label="5 out of 5 stars">
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
                <i class="fa-solid fa-star"></i>
              </div>
              <p class="story-quote">“I lost 10kg by tracking weekly and adjusting with data.”</p>
              <strong class="story-name">Melanie, 54</strong>
              <span class="story-outcome">Consistent weight loss</span>
            </div>
          </article>
        </div>
      </div>
    </section>

    <section id="faq" class="section section-alt">
      <div class="container">
        <div class="section-head text-center" data-aos="fade-up">
          <span class="section-kicker">FAQ</span>
          <h2>Frequently asked questions</h2>
          <p>Quick answers about security, exports, and admin access.</p>
        </div>
        <div class="faq-shell">
          <div class="accordion" id="faqAccordion">
            <div class="accordion-item" data-aos="fade-up">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                  Is my workout data private from other users?
                </button>
              </h2>
              <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                <div class="accordion-body">Yes. Your workout entries are account-scoped, and only authorized admin roles can access platform-level oversight views.</div>
              </div>
            </div>

            <div class="accordion-item" data-aos="fade-up" data-aos-delay="100">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                  Can I export my records for reports or coursework?
                </button>
              </h2>
              <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">Yes. Users can export workout history from the dashboard for documentation, analysis, and backup workflows.</div>
              </div>
            </div>

            <div class="accordion-item" data-aos="fade-up" data-aos-delay="200">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                  What happens if my account is archived by an admin?
                </button>
              </h2>
              <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">Archived accounts are temporarily blocked from login, but profile/workout data is preserved and restored when reactivated.</div>
              </div>
            </div>

            <div class="accordion-item" data-aos="fade-up" data-aos-delay="300">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                  Which import formats are supported for workout uploads?
                </button>
              </h2>
              <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">FitTrack supports structured JSON and CSV imports for consistent, auditable workout ingestion.</div>
              </div>
            </div>

            <div class="accordion-item" data-aos="fade-up" data-aos-delay="400">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                  How are passwords and login sessions protected?
                </button>
              </h2>
              <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">Passwords are securely hashed, requests are CSRF-protected, and role-based session checks guard restricted pages.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="cta">
      <div class="container">
        <h3 data-aos="fade-up">Start with structure, then build momentum.</h3>
        <p data-aos="fade-up" data-aos-delay="100">Track daily, review weekly, and improve with evidence.</p>
        <a href="{{ url_for('register') }}" class="btn btn-light btn-lg mt-3">Create Your Account</a>
      </div>
    </section>
  </main>

  {% include '_shared_footer.html' %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="{{ url_for('static', filename='js/nav-adaptive.js') }}"></script>
  <script nonce="{{ csp_nonce() }}">
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    AOS.init({
      once: true,
      duration: prefersReducedMotion ? 0 : 700,
      disable: prefersReducedMotion
    });

    const sectionIds = ['home', 'benefits', 'how', 'stories', 'faq'];
    const homeNav = document.querySelector('.ft-nav');
    const sectionSurface = {
      home: 'dark',
      benefits: 'light',
      how: 'light',
      stories: 'light',
      faq: 'light'
    };
    const sectionLinkMap = new Map();
    document.querySelectorAll('.navbar .nav-link[href^="#"], .home-sidebar .sidebar-nav .nav-link[href^="#"]').forEach((link) => {
      const targetId = (link.getAttribute('href') || '').replace('#', '');
      if (!targetId) return;
      if (!sectionLinkMap.has(targetId)) sectionLinkMap.set(targetId, []);
      sectionLinkMap.get(targetId).push(link);
    });

    function setActiveSection(sectionId) {
      const darkSurface = sectionSurface[sectionId] === 'dark';
      if (homeNav) {
        homeNav.classList.toggle('is-glass', darkSurface);
        homeNav.classList.toggle('is-solid', !darkSurface);
      }
      sectionLinkMap.forEach((links, id) => {
        links.forEach((link) => {
          const active = id === sectionId;
          link.classList.toggle('active', active);
          if (active) link.setAttribute('aria-current', 'page');
          else link.removeAttribute('aria-current');
        });
      });
    }

    setActiveSection('home');

    const sections = sectionIds.map((id) => document.getElementById(id)).filter(Boolean);
    if ('IntersectionObserver' in window && sections.length) {
      const observer = new IntersectionObserver((entries) => {
        let winner = null;
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            if (!winner || entry.intersectionRatio > winner.intersectionRatio) winner = entry;
          }
        });
        if (winner?.target?.id) setActiveSection(winner.target.id);
      }, {
        threshold: [0.2, 0.4, 0.6],
        rootMargin: '-35% 0px -45% 0px'
      });
      sections.forEach((section) => observer.observe(section));
    }

    async function loadSnapshot() {
      const calEl = document.getElementById('snapCalories');
      const totalEl = document.getElementById('snapTotal');
      const goalEl = document.getElementById('snapGoal');
      const bars = Array.from(document.querySelectorAll('.snapshot-bars .bar'));
      if (!calEl || !totalEl || !goalEl || bars.length !== 7) return;

      try {
        const res = await fetch('/api/public-stats', { cache: 'no-store' });
        if (!res.ok) return;
        const data = await res.json();

        calEl.textContent = Number(data.calories_7d || 0).toLocaleString();
        totalEl.textContent = Number(data.total_workouts || 0).toLocaleString();
        goalEl.textContent = Number(data.weekly_goal_pct || 0).toLocaleString();

        const weekly = Array.isArray(data.weekly_calories) ? data.weekly_calories.slice(0, 7) : [];
        const labels = Array.isArray(data.weekly_labels) ? data.weekly_labels.slice(0, 7) : [];
        if (weekly.length !== 7) return;

        const maxValue = Math.max(...weekly, 1);
        bars.forEach((bar, index) => {
          const value = Number(weekly[index] || 0);
          const label = labels[index] || `Day ${index + 1}`;
          const heightPct = value > 0 ? Math.max(14, Math.round((value / maxValue) * 100)) : 10;
          bar.style.height = `${heightPct}%`;
          bar.style.opacity = value > 0 ? '1' : '0.35';
          bar.title = `${label}: ${value} kcal`;
          bar.setAttribute('aria-label', `${label}: ${value} calories`);
        });
      } catch {
        // keep fallback values
      }
    }

    loadSnapshot();
    const SNAPSHOT_INTERVAL_MS = 15000;
    let snapshotTimer = null;
    function startSnapshotPolling() {
      if (snapshotTimer) return;
      snapshotTimer = setInterval(() => {
        if (document.visibilityState === 'visible') loadSnapshot();
      }, SNAPSHOT_INTERVAL_MS);
    }
    function stopSnapshotPolling() {
      if (!snapshotTimer) return;
      clearInterval(snapshotTimer);
      snapshotTimer = null;
    }
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        loadSnapshot();
        startSnapshotPolling();
      } else {
        stopSnapshotPolling();
      }
    });
    startSnapshotPolling();

    document.querySelectorAll('.home-sidebar a[href^="#"]').forEach((link) => {
      link.addEventListener('click', (event) => {
        const targetId = link.getAttribute('href');
        const target = document.querySelector(targetId);
        if (!target) return;
        event.preventDefault();
        const offcanvasEl = document.getElementById('homeSidebar');
        const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl) || new bootstrap.Offcanvas(offcanvasEl);
        offcanvas.hide();
        setTimeout(() => {
          target.scrollIntoView({ behavior: prefersReducedMotion ? 'auto' : 'smooth', block: 'start' });
          history.replaceState(null, '', targetId);
          setActiveSection(targetId.replace('#', ''));
        }, 220);
      });
    });

    document.querySelectorAll('.navbar .nav-link[href^="#"]').forEach((link) => {
      link.addEventListener('click', () => {
        const targetId = (link.getAttribute('href') || '').replace('#', '');
        if (targetId) setActiveSection(targetId);
      });
    });

    document.querySelectorAll('.home-sidebar a[href]:not([href^="#"])').forEach((link) => {
      link.addEventListener('click', (event) => {
        const href = link.getAttribute('href');
        if (!href) return;
        event.preventDefault();
        const offcanvasEl = document.getElementById('homeSidebar');
        const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl) || new bootstrap.Offcanvas(offcanvasEl);
        offcanvas.hide();
        setTimeout(() => {
          window.location.href = href;
        }, 180);
      });
    });
  </script>
</body>
</html>
